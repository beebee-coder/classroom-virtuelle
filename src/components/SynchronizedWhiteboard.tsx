
'use client';

import { Whiteboard } from './Whiteboard';
import { ExcalidrawScene } from '@/types';
import { useEffect } from 'react';

interface SynchronizedWhiteboardProps {
  sessionId: string;
  whiteboardControllerId: string | null;
  currentUserId: string;
  initialScene?: ExcalidrawScene | null;
  onPersist: (scene: ExcalidrawScene) => void;
}

export function SynchronizedWhiteboard({
  sessionId,
  whiteboardControllerId,
  currentUserId,
  initialScene,
  onPersist
}: SynchronizedWhiteboardProps) {

  const isController = currentUserId === whiteboardControllerId;

  console.log(`üîÑ [SyncWB] Rendu. estContr√¥leur: ${isController}. Sc√®ne initiale fournie: ${!!initialScene}`);
  
  useEffect(() => {
    console.log('üñºÔ∏è [SyncWB] useEffect: La sc√®ne initiale a chang√©.', initialScene ? 'Donn√©es pr√©sentes' : 'Donn√©es absentes');
  }, [initialScene]);

  const handleWhiteboardChange = (elements: readonly any[], appState: any) => {
    console.log('‚úçÔ∏è [SyncWB] handleWhiteboardChange: Changement d√©tect√© sur le tableau blanc.');
    onPersist({ elements, appState });
  }

  return (
    <div className="h-full w-full relative">
      <Whiteboard
        sessionId={sessionId}
        onWhiteboardChange={handleWhiteboardChange}
        initialElements={initialScene?.elements}
        initialAppState={initialScene?.appState}
        isController={isController}
      />
    </div>
  );
}
