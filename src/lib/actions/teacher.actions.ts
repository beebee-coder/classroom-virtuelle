// src/lib/actions/teacher.actions.ts
'use server';

import { revalidatePath } from 'next/cache';
import type { StudentProgress, Task, User } from '@prisma/client';

type TaskForProfessorValidation = StudentProgress & {
  task: Task;
  student: Pick<User, 'id' | 'name'>;
};


// ---=== BYPASS BACKEND ===---
export async function getTasksForProfessorValidation(teacherId: string): Promise<TaskForProfessorValidation[]> {
    console.log(`üëÄ [BYPASS] R√©cup√©ration des t√¢ches √† valider pour le professeur ${teacherId} (factice).`);
    return [
      {
        id: 'progress1',
        studentId: 'student1',
        taskId: 'task-math',
        status: 'PENDING_VALIDATION',
        completionDate: new Date(),
        submissionUrl: 'https://picsum.photos/seed/proof1/400/300',
        pointsAwarded: 0,
        accuracy: null,
        recipeName: null,
        feedback: null,
        task: { 
            id: 'task-math', 
            title: 'Exercice de maths', 
            description: 'R√©soudre une s√©rie de probl√®mes complexes.',
            points: 70, 
            type: 'WEEKLY', 
            category: 'MATH', 
            difficulty: 'MEDIUM',
            validationType: 'PROFESSOR',
            requiresProof: true,
            attachmentUrl: null,
            isActive: true,
            startTime: null,
            duration: null,
        },
        student: { id: 'student1', name: 'Alice' },
      },
      {
        id: 'progress2',
        studentId: 'student2',
        taskId: 'task-science',
        status: 'PENDING_VALIDATION',
        completionDate: new Date(),
        submissionUrl: 'https://picsum.photos/seed/proof2/400/300',
        pointsAwarded: 0,
        accuracy: null,
        recipeName: null,
        feedback: null,
        task: { 
            id: 'task-science', 
            title: 'Expos√© scientifique', 
            description: 'Pr√©parer et pr√©senter un sujet scientifique.',
            points: 250, 
            type: 'MONTHLY', 
            category: 'SCIENCE', 
            difficulty: 'HARD',
            validationType: 'PROFESSOR',
            requiresProof: true,
            attachmentUrl: null,
            isActive: true,
            startTime: null,
            duration: null,
        },
        student: { id: 'student2', name: 'Bob' },
      }
    ] as unknown as TaskForProfessorValidation[];
}

export interface ProfessorValidationPayload {
    progressId: string;
    approved: boolean;
    pointsAwarded?: number;
    rejectionReason?: string;
}

export async function validateTaskByProfessor(payload: ProfessorValidationPayload) {
    console.log('üëç [BYPASS] Validation de t√¢che par le professeur (factice):', payload);

    // Simule la revalidation
    revalidatePath('/teacher/validations');

    // Simule une notification ou une mise √† jour de points
    return {
        studentName: '√âl√®ve Test',
        taskTitle: 'T√¢che Test',
        pointsAwarded: payload.approved ? (payload.pointsAwarded || 50) : 0,
    };
}

export async function resetAllStudentData() {
  console.log('üîÑ [BYPASS] R√©initialisation de toutes les donn√©es √©l√®ve (factice).');
  revalidatePath('/teacher');
  return { success: true, message: "Toutes les donn√©es des √©l√®ves ont √©t√© r√©initialis√©es (simulation)." };
}
// ---=========================---
